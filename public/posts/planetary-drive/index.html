<!DOCTYPE html>
<html lang="en-us">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="theme-color" content="#333">
	<meta name="msapplication-TileColor" content="#333">
<meta itemprop="name" content="Planetary drive">
<meta itemprop="description" content="Urbit is a manifestation of the cypherpunk ethos &ndash; your communication is relayed through a decentralized network, with all traffic encrypted all the time. Well, most of the time; it&rsquo;s not encrypted at rest, meaning physical access to your device means full access to its history. There&rsquo;s no technical reason that it must remain this way, though, and I&rsquo;ve decided to run my pier from an encrypted disk.
For about the last year or so, I&rsquo;ve run my urbit planet ~sitful-hatred on a Digital Ocean VPS.">
<meta itemprop="datePublished" content="2020-08-30T14:28:42-05:00" />
<meta itemprop="dateModified" content="2020-08-30T14:28:42-05:00" />
<meta itemprop="wordCount" content="1051">
<meta itemprop="image" content="https://subject.network/img/pavepaws.png">



<meta itemprop="keywords" content="urbit,luks,encryption," />
<meta property="og:title" content="Planetary drive" />
<meta property="og:description" content="Urbit is a manifestation of the cypherpunk ethos &ndash; your communication is relayed through a decentralized network, with all traffic encrypted all the time. Well, most of the time; it&rsquo;s not encrypted at rest, meaning physical access to your device means full access to its history. There&rsquo;s no technical reason that it must remain this way, though, and I&rsquo;ve decided to run my pier from an encrypted disk.
For about the last year or so, I&rsquo;ve run my urbit planet ~sitful-hatred on a Digital Ocean VPS." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://subject.network/posts/planetary-drive/" />
<meta property="og:image" content="https://subject.network/img/pavepaws.png" />
<meta property="article:published_time" content="2020-08-30T14:28:42-05:00" />
<meta property="article:modified_time" content="2020-08-30T14:28:42-05:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://subject.network/img/pavepaws.png"/>

<meta name="twitter:title" content="Planetary drive"/>
<meta name="twitter:description" content="Urbit is a manifestation of the cypherpunk ethos &ndash; your communication is relayed through a decentralized network, with all traffic encrypted all the time. Well, most of the time; it&rsquo;s not encrypted at rest, meaning physical access to your device means full access to its history. There&rsquo;s no technical reason that it must remain this way, though, and I&rsquo;ve decided to run my pier from an encrypted disk.
For about the last year or so, I&rsquo;ve run my urbit planet ~sitful-hatred on a Digital Ocean VPS."/>

	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="/favicon.ico">

	<title>Planetary drive</title>
	<link rel="stylesheet" href="https://subject.network/css/style.min.5f66d6bd6751a10ba7350142ac010f4e4c42b5a3f628c93bde75a9a19d70ad5c.css" integrity="sha256-X2bWvWdRoQunNQFCrAEPTkxCtaP2KMk73nWpoZ1wrVw=" crossorigin="anonymous">
	<link rel="stylesheet" href="https://subject.network/css/override.css">
</head>

<body id="page">
	
	<header id="site-header" class="animated slideInUp">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					⏣ <a href="https://subject.network">networked subject</a>_
				</div>
				<nav class="site-nav hide-in-mobile">
					
				<a href="https://subject.network/posts/">Posts</a>
				<a href="https://subject.network/about/">About</a>

				</nav>
			</div>
			<div class="hdr-right hdr-icons"><button id="menu-btn" class="hdr-btn" title="Menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="https://subject.network/posts/">Posts</a></li>
			<li><a href="https://subject.network/about/">About</a></li>
		</ul>
	</div>


	<main class="site-main section-inner animated fadeIn faster">
		<article class="thin">
			<header class="post-header">
				<div class="post-meta"><span>Aug 30, 2020</span></div>
				<h1>Planetary drive</h1>
			</header>
			<div class="content">
				<p><a href=""><img src="/img/pavepaws.png" alt=""></a></p>
<p>Urbit is a manifestation of the cypherpunk ethos &ndash; your communication is relayed through a decentralized network, with all traffic encrypted all the time. Well, most of the time; it&rsquo;s not encrypted at rest, meaning physical access to your device means full access to its history. There&rsquo;s no technical reason that it must remain this way, though, and I&rsquo;ve decided to run my pier from an encrypted disk.</p>
<p>For about the last year or so, I&rsquo;ve run my urbit planet <code>~sitful-hatred</code> on a Digital Ocean VPS. However, I decided that I would like to have my planet on a device in my physical possession. I have a sentimental and practical desire to keep my important data secure and at-hand; I also had a spare SSD collecting dust inside my desktop, and this was the first good idea I had for making use of it &ndash; encrypting a bunch of books and music didn&rsquo;t seem as cool.</p>
<p>I think decryption at rest by default is a sane default for something that aspires to be a major platform &ndash; leaving your phone&rsquo;s data on Apple&rsquo;s servers is <a href="https://www.engadget.com/2020-01-21-apple-dropped-plan-for-encrypted-icloud-backups.html">insecure</a>, which gets the feds off their back (to some degree). This can of course be trivially sidestepped, by setting a real passcode to unlock your phone and disabling cloud backups, but nobody does this. Decryption at rest for your ship by default means only the technically-inclined or adventurous of spirit will bother to secure their pier; but it also allows for easier recovery of data if something goes wrong, or a password is forgotten. It probably is best for most people, most of the time.</p>
<p>But encryption is a blanket. Encryption is a moat between you and the world. Encryption is how you take care of what&rsquo;s important and personal.</p>
<p>So, to cut a long introduction short, the following is a tutorial in running your urbit from an encrypted drive or partition on Ubuntu. The steps taken to encrypt the drive are shamelessly pillaged from <a href="https://davidyat.es/2015/04/03/encrypting-a-second-hard-drive-on-ubuntu-14-10-post-install/">here</a> &ndash; total credit to Mr Yates, because worked out the hard part.</p>
<p>One last word of warning: messing with partitions and disk formatting is very easy to screw up! If you don&rsquo;t understand what is happening when you follow these steps, it may be better to skip this one, though you probably won&rsquo;t do anything unrecoverable if you screw up &ndash; just double and triple check that you&rsquo;re performing operations on the correct device.</p>
<hr>
<h3 id="1-clear-the-partitions">1. Clear the partitions<a href="#1-clear-the-partitions" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>Before you can encrypt the drive with LUKS, you&rsquo;ll need to delete the partitions on it. Using gparted, select the device you&rsquo;re using in the <code>Gparted-&gt; Devices</code> menu. It will display a graphical representation of the drive, along with any existing partitions. Delete all partitions, create an unformatted partition of the desired size, make a double check that you&rsquo;re doing this to the correct device, and hit apply.</p>
<p>You will not be formatting the drive quite yet. Do not mount it, or interact with the device outside of these instructions until you are finished.</p>
<h3 id="2-setting-up-luks">2. Setting up LUKS<a href="#2-setting-up-luks" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>** Replace <code>sd?X</code> with the name of your device (e.g, <code>/dev/sdc</code>). You can identify the device name in Gparted, or by running <code>lsblk</code>.**</p>
<p>Now we will run <code>cryptsetup</code> to set up the device&rsquo;s encryption:</p>
<div class="window" width="80%">
    <div class="titlebar">
      <div class="buttons">
        <div class="bclose">
        </div>
        <div class="minimize">
        </div>
        <div class="zoom">
        </div>
      </div>
      terminal: ~
    </div>
    <div class="termwin">
      <ul>
        
        
        <li></li>
        
        
        <li>$>&nbsp;sudo&nbsp;cryptsetup&nbsp;-y&nbsp;-v&nbsp;luksFormat&nbsp;/dev/sd?X</li>
        
        
        <li>&nbsp;</li>
        
        
        <li></li>
        
        
        <li></li>
          
      </ul>
    </div>
  </div>

<p>Enter a strong password and write it down. You won&rsquo;t need to remember it so you can go the extra mile with complexity, but at some point in the future you will probably need to recover it.</p>
<p>Next, perform the following operations:</p>
<div class="window" width="80%">
    <div class="titlebar">
      <div class="buttons">
        <div class="bclose">
        </div>
        <div class="minimize">
        </div>
        <div class="zoom">
        </div>
      </div>
      terminal: ~
    </div>
    <div class="termwin">
      <ul>
        
        
        <li></li>
        
        
        <li>$>&nbsp;sudo&nbsp;cryptsetup&nbsp;luksOpen&nbsp;/dev/sd?X&nbsp;sd?X_crypt</li>
        
        
        <li>$>&nbsp;sudo&nbsp;mkfs.ext4&nbsp;/dev/mapper/sd?X_crypt</li>
        
        
        <li>&nbsp;</li>
        
        
        <li></li>
        
        
        <li></li>
          
      </ul>
    </div>
  </div>

<p>This will decrypt the partition, and format it in <a href="https://www.wikiwand.com/en/Ext4">ext4</a>. Now, it&rsquo;s ready to mount:</p>
<div class="window" width="80%">
    <div class="titlebar">
      <div class="buttons">
        <div class="bclose">
        </div>
        <div class="minimize">
        </div>
        <div class="zoom">
        </div>
      </div>
      terminal: ~
    </div>
    <div class="termwin">
      <ul>
        
        
        <li></li>
        
        
        <li>$>&nbsp;sudo&nbsp;mount&nbsp;/dev/mapper/sd?X_crypt&nbsp;/<mount-point></li>
        
        
        <li>&nbsp;</li>
        
        
        <li></li>
        
        
        <li></li>
          
      </ul>
    </div>
  </div>

<p>Your mount point can be arbitrary, but on Ubuntu is usually a directory inside <code>/media/</code> &ndash; mine is <code>/media/Data/</code>. You can interact with your newly formatted drive in this folder.</p>
<h3 id="4-keyfile--auto-mount">4. Keyfile &amp; auto-mount<a href="#4-keyfile--auto-mount" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>A cool trick I didn&rsquo;t know about until reading the previously-linked tutorial is that you can make your machine automatically mount a LUKS drive using a keyfile. In order to do so, we&rsquo;ll generate a file of random noise and add it as a key for the drive:</p>
<div class="window" width="80%">
    <div class="titlebar">
      <div class="buttons">
        <div class="bclose">
        </div>
        <div class="minimize">
        </div>
        <div class="zoom">
        </div>
      </div>
      terminal: ~
    </div>
    <div class="termwin">
      <ul>
        
        
        <li></li>
        
        
        <li>$>&nbsp;sudo&nbsp;dd&nbsp;if=/dev/urandom&nbsp;of=/root/.keyfile&nbsp;bs=1024&nbsp;count=4</li>
        
        
        <li>$>&nbsp;sudo&nbsp;chmod&nbsp;0400&nbsp;/root/.keyfile</li>
        
        
        <li>$>&nbsp;sudo&nbsp;cryptsetup&nbsp;luksAddKey&nbsp;/dev/sd?X&nbsp;/root/.keyfile</li>
        
        
        <li>&nbsp;</li>
        
        
        <li></li>
        
        
        <li></li>
          
      </ul>
    </div>
  </div>

<p>Next we&rsquo;ll need to tell the computer to mount the drive using the keyfile automatically. We&rsquo;ll need the device UUID (a unique identifier for the hardware), which we can find by looking at the output of:</p>
<div class="window" width="80%">
    <div class="titlebar">
      <div class="buttons">
        <div class="bclose">
        </div>
        <div class="minimize">
        </div>
        <div class="zoom">
        </div>
      </div>
      terminal: ~
    </div>
    <div class="termwin">
      <ul>
        
        
        <li></li>
        
        
        <li>$>&nbsp;sudo&nbsp;blkid</li>
        
        
        <li>&nbsp;</li>
        
        
        <li></li>
        
        
        <li></li>
          
      </ul>
    </div>
  </div>

<p>Look for the device you&rsquo;re working with, find where it says <code>UUID=&quot;longstringofnumbersandletters...&quot;</code> and copy the part between quotation marks. Next, use it to edit this command, replacing <code>&lt;device UUID&gt;</code>:</p>
<pre><code>  sd?X_crypt UUID=&lt;device UUID&gt; /root/.keyfile luks,discard
</code></pre><p>Make sure you&rsquo;re looking at the UUID of the device (e.g, <code>/dev/sdc</code>, <strong>not</strong> <code>/dev/sdc_crypt</code> or <code>/dev/sdc1/</code>).</p>
<p>Now we&rsquo;ll add the mount instructions to fstab:</p>
<div class="window" width="80%">
    <div class="titlebar">
      <div class="buttons">
        <div class="bclose">
        </div>
        <div class="minimize">
        </div>
        <div class="zoom">
        </div>
      </div>
      terminal: ~
    </div>
    <div class="termwin">
      <ul>
        
        
        <li></li>
        
        
        <li>$>&nbsp;sudo&nbsp;nano&nbsp;/etc/fstab</li>
        
        
        <li>$>&nbsp;/dev/mapper/sd?X_crypt&nbsp; /<mount-point>&nbsp; &nbsp;ext4&nbsp; &nbsp; defaults&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;2</li>
        
        
        <li>&nbsp;</li>
        
        
        <li></li>
        
        
        <li></li>
          
      </ul>
    </div>
  </div>

<p>Be sure to replace <code>/&lt;mount-point&gt;</code> with your preferred mount location (e.g, <code>/media/Data</code>).</p>
<p>Now to make sure that your device has the appropriated permissions, run the following command with your username and mount point replacing the original:</p>
<div class="window" width="80%">
    <div class="titlebar">
      <div class="buttons">
        <div class="bclose">
        </div>
        <div class="minimize">
        </div>
        <div class="zoom">
        </div>
      </div>
      terminal: ~
    </div>
    <div class="termwin">
      <ul>
        
        
        <li></li>
        
        
        <li>$>&nbsp;sudo&nbsp;chown&nbsp;<user>:<user>&nbsp;/<mount-point>&nbsp;-R</li>
        
        
        <li>&nbsp;</li>
        
        
        <li></li>
        
        
        <li></li>
          
      </ul>
    </div>
  </div>

<p>Now restart your device to test whether it successfully mounts on reboot. Voila, a fully encrypted disk you don&rsquo;t have to remember the password for!</p>
<h3 id="6-moving-your-pier">6. Moving your pier<a href="#6-moving-your-pier" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>This is the easy part. I moved my urbit from a remote server, so all I had to do was shutdown the process on the server and rsync the pier folder into my new drive:</p>
<div class="window" width="80%">
    <div class="titlebar">
      <div class="buttons">
        <div class="bclose">
        </div>
        <div class="minimize">
        </div>
        <div class="zoom">
        </div>
      </div>
      terminal: ~
    </div>
    <div class="termwin">
      <ul>
        
        
        <li></li>
        
        
        <li>$>&nbsp;rsync&nbsp;-av&nbsp;reid@subject.network:/~/sitful-hatred&nbsp;/media/Data</li>
        
        
        <li>&nbsp;</li>
        
        
        <li></li>
        
        
        <li></li>
          
      </ul>
    </div>
  </div>

<p>Urbit piers are completely portable; as long as you have the static binaries on another device and it&rsquo;s not trying to run in two places at once, you can simply pick up your data and move it with a copy operation. This is one of the reasons I wanted to devote a disk to my ship &ndash; I can swap it in and out of devices I may go through in the future, but maintain a physical token of my digital homestead. One day we&rsquo;ll all have e-ink mesh-networked urbit devices that run on solar panels and Optane drives, but for now I have my <code>+code</code> and an SSD.</p>
<hr>
<p><em>This post is also available on Urbit, where you can post comments. Join <a href="web+urbitgraph://group/~matwet/networked-subject/">~matwet/networked-subject</a> and open the Networked Subject notebook.</em></p>

			</div>
			<hr class="post-end">
			<footer class="post-info">
				<p>
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://subject.network/tags/urbit">urbit</a></span><span class="tag"><a href="https://subject.network/tags/luks">luks</a></span><span class="tag"><a href="https://subject.network/tags/encryption">encryption</a></span>
				</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2020-08-30 14:28 -0500</p>
			</footer>
		</article>
		<div class="post-nav thin">
			<a class="next-post" href="https://subject.network/posts/urbit-nginx-letsencrypt/">
				<span class="post-nav-label"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>&nbsp;Newer</span><br><span>Urbit, Nginx and Letsencrypt</span>
			</a>
			<a class="prev-post" href="https://subject.network/posts/urbit-introduction/">
				<span class="post-nav-label">Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><br><span>Urbit: An introduction</span>
			</a>
		</div>
		<div id="comments" class="thin">
</div>
	</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="/img/by-sa.svg" height=24px width=auto></a><p> 2021 <img src="/sitful-hatred.svg" height=24px width=24px style="vertical-align:middle;"><a href="https://subject.network">~sitful-hatred</a>
		</p>
	</footer>



	<script src="https://subject.network/js/bundle.min.4a9a0ac3d2217822c7865b4161e6c2a71de1d70492264337755427898dd718f6.js" integrity="sha256-SpoKw9IheCLHhltBYebCpx3h1wSSJkM3dVQniY3XGPY=" crossorigin="anonymous"></script>
	

</body>

</html>
